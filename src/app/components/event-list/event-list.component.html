<div class="page-container">
  <mat-card class="event-form-card">
    <h3>{{ currentEventId ? 'Modifier un événement' : 'Ajouter un événement' }}</h3>
    <form [formGroup]="eventForm" (ngSubmit)="currentEventId ? updateEvent() : addEvent()">
      <mat-form-field appearance="fill">
        <mat-label>Nom</mat-label>
        <input matInput formControlName="name" />
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Date</mat-label>
        <input matInput formControlName="date" type="date" />
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Lieu</mat-label>
        <input matInput formControlName="location" />
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Description</mat-label>
        <input matInput formControlName="description" />
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Organisateur</mat-label>
        <input matInput formControlName="organizer" />
      </mat-form-field>

      <div class="action-buttons">
        <button mat-raised-button color="primary" type="submit" [disabled]="eventForm.invalid">
          {{ currentEventId ? 'Mettre à jour' : 'Ajouter' }}
        </button>
      </div>
    </form>
  </mat-card>

  <!-- Tableau des événements -->
  <mat-card class="event-table-card">
    <h3>Liste des événements</h3>
    <table mat-table [dataSource]="events" class="mat-elevation-z8">
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef> Nom </th>
        <td mat-cell *matCellDef="let event"> {{ event.name }} </td>
      </ng-container>

      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef> Date </th>
        <td mat-cell *matCellDef="let event"> {{ event.date | date }} </td>
      </ng-container>

      <ng-container matColumnDef="location">
        <th mat-header-cell *matHeaderCellDef> Lieu </th>
        <td mat-cell *matCellDef="let event"> {{ event.location }} </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef> Actions </th>
        <td mat-cell *matCellDef="let event">
          <button mat-button color="accent" (click)="editEvent(event)">Modifier</button>
          <button mat-button color="warn" (click)="deleteEvent(event.id)">Supprimer</button>
          <button mat-button color="primary" (click)="selectEvent(event.id)">Voir Participants</button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="['name', 'date', 'location', 'actions']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['name', 'date', 'location', 'actions'];"></tr>
    </table>
  </mat-card>

  <!-- Affichage des participants pour l'événement sélectionné -->
  <div *ngIf="selectedEventId">
    <app-participant-list [eventId]="selectedEventId"></app-participant-list>
  </div>
</div>
